<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyWeb</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<canvas id="starfield"></canvas>

<main class="code-area" id="codeArea">
    <!-- Search Button -->
    <div class="code-btn" data-target="search.html" style="left:80px; top:120px;">
<pre>
&lt;script&gt;
    if(search) searchDo();
&lt;/script&gt;
<span class="last-line"></span>
</pre>
    </div>

    <!-- Notes Button -->
    <div class="code-btn" data-target="sm1le.html" style="left:460px; top:260px;">
<pre>
&lt;script&gt;
    while(notes) open('MyNotes');
&lt;/script&gt;
<span class="last-line"></span>
</pre>
    </div>
</main>

<script src="starfield.js"></script>
<script>
// --- Code Page Logic ---
(function() {
    const TYPING_SPEED = 80;
    const FINISH_DELAY_AFTER_SPARKLE = 1000;
    const SPARKLE_COUNT = 14;

    const buttons = Array.from(document.querySelectorAll('.code-btn'));

    // Bounce variables
    let items = buttons.map((el, index) => ({
        el,
        x: parseFloat(el.style.left) || 100,
        y: parseFloat(el.style.top) || 100,
        w: el.offsetWidth,
        h: el.offsetHeight,
        vx: (Math.random()*0.2 + 0.05) * (Math.random()<0.5?-1:1),
        vy: (Math.random()*0.2 + 0.05) * (Math.random()<0.5?-1:1),
        frozen: false
    }));

    // Animation loop
    function step() {
        const ar = {left:0, top:0, right:window.innerWidth, bottom:window.innerHeight};
        items.forEach(it => {
            if(it.frozen) return;
            it.x += it.vx;
            it.y += it.vy;
            if(it.x < ar.left){it.x=ar.left; it.vx*=-1;}
            if(it.x > ar.right-it.w){it.x=ar.right-it.w; it.vx*=-1;}
            if(it.y < ar.top){it.y=ar.top; it.vy*=-1;}
            if(it.y > ar.bottom-it.h){it.y=ar.bottom-it.h; it.vy*=-1;}
            it.el.style.left = it.x+'px';
            it.el.style.top = it.y+'px';
        });
        requestAnimationFrame(step);
    }
    step();

    // Typing + sparkle + redirect
    function typeLastLine(el, onComplete){
        const last = el.querySelector('.last-line');
        const pre = el.querySelector('pre');
        if(!last) { onComplete(); return; }
        // Full text
        let fullText = pre.textContent.replace(/\u00A0/g,'').trim();
        pre.textContent = '';
        last.textContent='';
        let i=0;
        function stepChar(){
            if(i<=fullText.length){
                pre.textContent = fullText.slice(0,i);
                i++;
                setTimeout(stepChar,TYPING_SPEED);
            } else {
                onComplete();
            }
        }
        stepChar();
    }

    function playSparkles(hostEl, onDone){
        const container = document.createElement('div');
        container.className='sparkle';
        hostEl.appendChild(container);
        const rect = hostEl.getBoundingClientRect();
        for(let k=0;k<SPARKLE_COUNT;k++){
            const dot = document.createElement('div');
            dot.className='dot';
            dot.style.left = (Math.random()*rect.width)+'px';
            dot.style.top = (Math.random()*rect.height)+'px';
            dot.style.animationDelay=(Math.random()*220)+'ms';
            container.appendChild(dot);
        }
        setTimeout(()=>{container.remove(); if(onDone) onDone();},900);
    }

    buttons.forEach(it=>{
        it.addEventListener('click',()=>{
            if(it.dataset.frozen) return;
            it.dataset.frozen=true;
            typeLastLine(it, ()=>{
                playSparkles(it, ()=>{
                    setTimeout(()=>{window.location.href=it.dataset.target;},FINISH_DELAY_AFTER_SPARKLE);
                });
            });
        });
    });

})();
</script>
</body>
</html>

