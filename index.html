<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MyWeb Search</title>
<style>
  @font-face {
    font-family: 'San Francisco';
    src: local('-apple-system'), local('BlinkMacSystemFont'),
      local('Segoe UI'), local('Roboto'), local('Ubuntu'),
      local('Cantarell'), local('Fira Sans'), local('Droid Sans'),
      local('Helvetica Neue'), sans-serif;
  }

  :root {
    --bg-light: #fafafa;
    --bg-dark: #1e1e1e;
    --text-light: #222;
    --text-dark: #ddd;
    --accent: #ff6f00; /* orange-ish */
    --radius: 12px;
  }

  body {
    margin: 0;
    font-family: 'San Francisco', -apple-system, BlinkMacSystemFont,
      'Segoe UI', Roboto, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans',
      'Helvetica Neue', sans-serif;
    background: var(--bg-light);
    color: var(--text-light);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  body.dark {
    background: var(--bg-dark);
    color: var(--text-dark);
  }

  header {
    text-align: center;
    padding: 1.5rem 1rem 0.25rem;
  }

  header h1 {
    margin: 0;
    font-weight: 600;
    font-size: 2.5rem;
    color: var(--accent);
  }

  #search-container {
    margin: 1rem auto;
    max-width: 600px;
    width: 90%;
    display: flex;
    gap: 0.5rem;
  }

  #search-input {
    flex-grow: 1;
    padding: 0.6rem 1rem;
    font-size: 1.1rem;
    border: 2px solid var(--accent);
    border-radius: var(--radius);
    outline-offset: 2px;
    outline-color: transparent;
    transition: outline-color 0.2s ease;
  }

  #search-input:focus {
    outline-color: var(--accent);
  }

  #search-button {
    background: var(--accent);
    border: none;
    color: white;
    font-weight: 600;
    border-radius: var(--radius);
    padding: 0 1.2rem;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  #search-button:hover {
    background: #e65c00;
  }

  #dark-mode-toggle {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--accent);
    border: none;
    color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 9999px;
    cursor: pointer;
    font-weight: 600;
    user-select: none;
    transition: background-color 0.2s ease;
    z-index: 1000;
  }
  #dark-mode-toggle:hover {
    background: #e65c00;
  }

  main {
    flex-grow: 1;
    max-width: 900px;
    margin: 0 auto 2rem;
    width: 90%;
  }

  #results {
    margin-top: 1rem;
    background: var(--bg-light);
    border-radius: var(--radius);
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    max-height: 65vh;
    overflow-y: auto;
    padding: 1rem;
  }

  body.dark #results {
    background: #2a2a2a;
    box-shadow: 0 2px 12px rgb(255 111 0 / 0.3);
  }

  .result-item {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.25rem;
    border-bottom: 1px solid #ddd;
    padding-bottom: 1rem;
  }

  body.dark .result-item {
    border-color: #444;
  }

  .result-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .result-thumbnail img {
    width: 120px;
    height: 90px;
    object-fit: cover;
    border-radius: var(--radius);
    flex-shrink: 0;
  }

  .result-details {
    flex-grow: 1;
  }

  .result-title {
    font-size: 1.15rem;
    margin: 0 0 0.3rem 0;
    color: var(--accent);
    cursor: pointer;
    text-decoration: none;
  }
  .result-title:hover {
    text-decoration: underline;
  }

  body.dark .result-title {
    color: #ff9c3c;
  }

  .result-link {
    font-size: 0.9rem;
    color: #006621;
    margin-bottom: 0.3rem;
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  body.dark .result-link {
    color: #99cc66;
  }

  .result-snippet {
    font-size: 0.95rem;
    line-height: 1.3;
    color: #444;
  }

  body.dark .result-snippet {
    color: #ccc;
  }

  @media (max-width: 600px) {
    #search-container {
      flex-direction: column;
    }
    #search-button {
      width: 100%;
    }
    .result-item {
      flex-direction: column;
    }
    .result-thumbnail img {
      width: 100%;
      height: auto;
    }
  }
</style>
</head>
<body>
  <button id="dark-mode-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
  <header>
    <h1>MyWeb</h1>
  </header>
  <section id="search-container" role="search" aria-label="Search form">
    <input
      type="search"
      id="search-input"
      placeholder="Search MyWeb..."
      aria-label="Search query"
      autocomplete="off"
      spellcheck="false"
    />
    <button id="search-button" aria-label="Search">Search</button>
  </section>

  <main>
    <section id="results" aria-live="polite" aria-relevant="additions"></section>
  </main>

<script>
  const apiURL = 'https://bob.mylesjohn2012.workers.dev/';

  const darkModeToggle = document.getElementById('dark-mode-toggle');
  const body = document.body;
  const searchInput = document.getElementById('search-input');
  const searchButton = document.getElementById('search-button');
  const resultsContainer = document.getElementById('results');

  // Load dark mode preference
  if (localStorage.getItem('darkMode') === 'enabled') {
    body.classList.add('dark');
    darkModeToggle.textContent = 'â˜€ï¸';
  }

  darkModeToggle.addEventListener('click', () => {
    body.classList.toggle('dark');
    if (body.classList.contains('dark')) {
      localStorage.setItem('darkMode', 'enabled');
      darkModeToggle.textContent = 'â˜€ï¸';
    } else {
      localStorage.setItem('darkMode', 'disabled');
      darkModeToggle.textContent = 'ðŸŒ™';
    }
  });

  function createResultItem(item) {
    const container = document.createElement('div');
    container.className = 'result-item';

    // Thumbnail
    const thumbDiv = document.createElement('div');
    thumbDiv.className = 'result-thumbnail';
    if (item.pagemap && item.pagemap.cse_thumbnail && item.pagemap.cse_thumbnail.length > 0) {
      const img = document.createElement('img');
      img.src = item.pagemap.cse_thumbnail[0].src;
      img.alt = item.title || 'Thumbnail';
      thumbDiv.appendChild(img);
    }
    container.appendChild(thumbDiv);

    // Details
    const details = document.createElement('div');
    details.className = 'result-details';

    // Title
    const title = document.createElement('a');
    title.className = 'result-title';
    title.href = item.link;
    title.textContent = item.title;
    title.target = '_blank';
    title.rel = 'noopener noreferrer';
    details.appendChild(title);

    // Link
    const link = document.createElement('a');
    link.className = 'result-link';
    link.href = item.link;
    link.textContent = item.displayLink || item.link;
    link.target = '_blank';
    link.rel = 'noopener noreferrer';
    details.appendChild(link);

    // Snippet
    const snippet = document.createElement('p');
    snippet.className = 'result-snippet';
    snippet.textContent = item.snippet;
    details.appendChild(snippet);

    container.appendChild(details);

    return container;
  }

  async function performSearch(query) {
    resultsContainer.innerHTML = '<p>Loading...</p>';
    try {
      const response = await fetch(apiURL + '?q=' + encodeURIComponent(query));
      if (!response.ok) throw new Error('API error');
      const data = await response.json();

      if (!data.items || data.items.length === 0) {
        resultsContainer.innerHTML = '<p>No results found.</p>';
        return;
      }

      resultsContainer.innerHTML = '';
      data.items.forEach(item => {
        const resultItem = createResultItem(item);
        resultsContainer.appendChild(resultItem);
      });
    } catch (e) {
      resultsContainer.innerHTML = '<p>Error fetching results.</p>';
      console.error(e);
    }
  }

  searchButton.addEventListener('click', () => {
    const q = searchInput.value.trim();
    if (q) performSearch(q);
  });

  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      const q = searchInput.value.trim();
      if (q) performSearch(q);
    }
  });
</script>
</body>
</html>
